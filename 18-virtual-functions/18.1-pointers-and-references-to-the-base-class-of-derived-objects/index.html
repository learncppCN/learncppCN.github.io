
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
      <link rel="shortcut icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.1.2, mkdocs-material-7.0.0">
    
    
      
        <title>18.1 基类指针和引用指向派生类 - LearnCPP 中文教程</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.a3f8f96a.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.7fa14f5b.min.css">
        
      
    
    
    
      
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>:root{--md-text-font-family:"Roboto";--md-code-font-family:"Roboto Mono"}</style>
      
    
    
    
    
      
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="none" data-md-color-accent="none">
      
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#181" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="LearnCPP 中文教程" class="md-header__button md-logo" aria-label="LearnCPP 中文教程">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            LearnCPP 中文教程
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              18.1 基类指针和引用指向派生类
            
          </span>
        </div>
      </div>
    </div>
    <div class="md-header__options">
      
    </div>
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" data-md-state="active" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    




<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="LearnCPP 中文教程" class="md-nav__button md-logo" aria-label="LearnCPP 中文教程">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    LearnCPP 中文教程
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        目录
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../%E7%BF%BB%E8%AF%91%E6%97%A5%E8%AE%B0/" class="md-nav__link">
        翻译日记
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3" >
      
      <label class="md-nav__link" for="nav-3">
        00 Introduction getting started
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="00 Introduction getting started" data-md-level="1">
        <label class="md-nav__title" for="nav-3">
          <span class="md-nav__icon md-icon"></span>
          00 Introduction getting started
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../00-Introduction-getting-started/" class="md-nav__link">
        第零章 介绍/起步
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../00-Introduction-getting-started/0.1-Introduction-to-these-tutorials/" class="md-nav__link">
        0.1 教程介绍
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4" >
      
      <label class="md-nav__link" for="nav-4">
        08 basic object oriented programming
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="08 basic object oriented programming" data-md-level="1">
        <label class="md-nav__title" for="nav-4">
          <span class="md-nav__icon md-icon"></span>
          08 basic object oriented programming
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../08-basic-object-oriented-programming/" class="md-nav__link">
        第八章 面向对象编程基础
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../08-basic-object-oriented-programming/8.1-welcome-to-object-oriented-programming/" class="md-nav__link">
        8.1 欢迎来到面向对象的世界
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../08-basic-object-oriented-programming/8.2-classes-and-class-member/" class="md-nav__link">
        8.2 类和类成员 (Classes and class member)
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="nav-5" type="checkbox" id="nav-5" >
      
      <label class="md-nav__link" for="nav-5">
        14 exceptions
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="14 exceptions" data-md-level="1">
        <label class="md-nav__title" for="nav-5">
          <span class="md-nav__icon md-icon"></span>
          14 exceptions
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../14-exceptions/" class="md-nav__link">
        14 异常
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../14-exceptions/14.1-the-need-for-exceptions/" class="md-nav__link">
        14.1 为什么需要异常
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../14-exceptions/14.2-basic-exception-handloing/" class="md-nav__link">
        14.2 基本异常处理
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../14-exceptions/14.3-exceptions-functions-and-stack-unwinding/" class="md-nav__link">
        14.3 异常，函数，栈展开
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../14-exceptions/14.4-uncaught-exceptions-catch-all-handlers-and-exception-specifiers/" class="md-nav__link">
        14.4 未捕获异常，捕获全部异常和异常说明符
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../14-exceptions/14.5-exceptions-classes-and-inheritance/" class="md-nav__link">
        14.5 异常，类和继承
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../14-exceptions/14.6-rethrowing-exceptions/" class="md-nav__link">
        14.6 异常的再抛出
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../14-exceptions/14.7-function-try-blocks/" class="md-nav__link">
        14.7 函数级的 try 代码块
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../14-exceptions/14.8-exception-dangers-and-downsides/" class="md-nav__link">
        14.8 异常的危险和缺点
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="nav-6" type="checkbox" id="nav-6" >
      
      <label class="md-nav__link" for="nav-6">
        15 move semantics and smart pointers
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="15 move semantics and smart pointers" data-md-level="1">
        <label class="md-nav__title" for="nav-6">
          <span class="md-nav__icon md-icon"></span>
          15 move semantics and smart pointers
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../15-move-semantics-and-smart-pointers/" class="md-nav__link">
        15 移动语义和智能指针
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../15-move-semantics-and-smart-pointers/15.1-intro-to-smart-pointers-and-move-semantics/" class="md-nav__link">
        15.1 智能指针和移动语义的介绍
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../15-move-semantics-and-smart-pointers/15.2-r-value-reference/" class="md-nav__link">
        15.2 右值引用
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../15-move-semantics-and-smart-pointers/15.3-move-constructors-and-move-assignment/" class="md-nav__link">
        15.3 移动构造和移动赋值
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../15-move-semantics-and-smart-pointers/15.4-std%3A%3Amove/" class="md-nav__link">
        15.4 std::move
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../15-move-semantics-and-smart-pointers/15.5-std%3A%3Aunique_ptr/" class="md-nav__link">
        15.5 std::unique_ptr
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../15-move-semantics-and-smart-pointers/15.6-std%3A%3Ashared_ptr/" class="md-nav__link">
        15.6 std::shared_ptr
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../15-move-semantics-and-smart-pointers/15.7-std%3A%3Aweak_ptr/" class="md-nav__link">
        15.7 std::shared_ptr 的循环依赖问题，介绍 std::weak_ptr
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../15-move-semantics-and-smart-pointers/15.x-chapter15-comprehensive-review/" class="md-nav__link">
        15.x 十五章理解和复习
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="nav-7" type="checkbox" id="nav-7" checked>
      
      <label class="md-nav__link" for="nav-7">
        18 virtual functions
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="18 virtual functions" data-md-level="1">
        <label class="md-nav__title" for="nav-7">
          <span class="md-nav__icon md-icon"></span>
          18 virtual functions
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../" class="md-nav__link">
        第十八章 虚函数
      </a>
    </li>
  

          
            
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          18.1 基类指针和引用指向派生类
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        18.1 基类指针和引用指向派生类
      </a>
      
        
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    指针，引用和继承类
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    指向基类的指针和引用的使用方法
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../18.2-virtual-functions-and-polymorphism/" class="md-nav__link">
        18.2 — 虚函数和多态
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../18.3-The-override-and-final-specifiers-and-covariant-return-types/" class="md-nav__link">
        18.3 重写 final 标识符，并且协变返回类型
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../18.4-Virtual-destructors-virtual-assignment-and-overriding-virtualization/" class="md-nav__link">
        18.4 虚构造函数，虚赋值，重写虚函数
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../18.5-early-binding-and-late-binding/" class="md-nav__link">
        18.5 预绑定和后期绑定
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../18.6-the-virtual-table/" class="md-nav__link">
        18.6 虚表
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../18.7-virtual-base-classes/" class="md-nav__link">
        18.7 虚基类 (Virtual base classes)
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../18.8-object-slicing/" class="md-nav__link">
        18.8 对象切割
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../18.9-dynamic-casting/" class="md-nav__link">
        18.9 动态类型转换
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../18.x%20chapter-18-comprehensice-quiz/" class="md-nav__link">
        18.x 十二章理解和练习
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="nav-8" type="checkbox" id="nav-8" >
      
      <label class="md-nav__link" for="nav-8">
        19 templates
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="19 templates" data-md-level="1">
        <label class="md-nav__title" for="nav-8">
          <span class="md-nav__icon md-icon"></span>
          19 templates
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../19-templates/" class="md-nav__link">
        十九章 模板
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../19-templates/19.1-function-templates/" class="md-nav__link">
        19.1 函数模板 Function templates
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../19-templates/19.2-function-template-instances/" class="md-nav__link">
        19.2 类模板实例
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../19-templates/19.3-template-classes/" class="md-nav__link">
        19.3 模板类
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../19-templates/19.4-template-non-type-parameters/" class="md-nav__link">
        19.4 模板非类型参数
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../19-templates/19.5-function-template-specialization/" class="md-nav__link">
        19.5 函数模板特化
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../19-templates/19.6-class-template-specialization/" class="md-nav__link">
        19.6 类模板特化
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../19-templates/19.7-partial-template-specialization/" class="md-nav__link">
        19.7 模板局部特化
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../19-templates/19.8-partial-template-specialization-for-pointers/" class="md-nav__link">
        19.8 局部模板特化指针的
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../19-templates/19.x%20chapter-19-comprehensice-quiz/" class="md-nav__link">
        19.x - 19章节练习
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="nav-9" type="checkbox" id="nav-9" >
      
      <label class="md-nav__link" for="nav-9">
        23 input and output
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="23 input and output" data-md-level="1">
        <label class="md-nav__title" for="nav-9">
          <span class="md-nav__icon md-icon"></span>
          23 input and output
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../23-input-and-output/23.1-input-and-output-streams/" class="md-nav__link">
        18.1 输入输出流
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../23-input-and-output/23.2-input-with-istream/" class="md-nav__link">
        18.2 使用 istream 输入
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../23-input-and-output/23.3-output-with-ostream-and-ios/" class="md-nav__link">
        18.3 使用 ostrea 和 ios 进行输出
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    指针，引用和继承类
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    指向基类的指针和引用的使用方法
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                
                
                <h1 id="181">18.1 基类指针和引用指向派生类<a class="headerlink" href="#181" title="Permanent link">&para;</a></h1>
<!-- 12.1 — Pointers and references to the base class of derived objects -->

<blockquote>
<p>By Alex on January 29<sup>th</sup>, 2008 | last modified by nascardriver on December 5<sup>th</sup>, 2020
翻译 by dashjay 2020-12-17</p>
</blockquote>
<!-- In the previous chapter, you learned all about how to use inheritance to derive new classes from existing classes. In this chapter, we are going to focus on one of the most important and powerful aspects of inheritance -- virtual functions. -->

<p>在前些章节，我们学习了所有关于如何使用继承从已经存在的类来派生出新类。在这个章中，我们将专注学习继承中最重要和最强大的方面 -- 虚函数。</p>
<!-- But before we discuss what virtual functions are, let’s first set the table for why we need them. -->

<p>但是之前我们讨论过虚函数是什么，让我们先来说说为什么我们需要它。</p>
<!-- In the chapter on construction of derived classes, you learned that when you create a derived class, it is composed of multiple parts: one part for each inherited class, and a part for itself. -->

<p>在这个派生类的构造这个章节中，你了解了当你创建一个派生类的时候，它是由多个部分组成的：每一个都是一个继承类，和它本身的一个部分。</p>
<!-- For example, here’s a simple case: -->

<p>例如，这里有一个简单的例子：</p>
<div class="highlight"><pre><span></span><code><span class="cp">#include</span> <span class="cpf">&lt;string_view&gt;</span><span class="cp"></span>

<span class="k">class</span> <span class="nc">Base</span>
<span class="p">{</span>
<span class="k">protected</span><span class="o">:</span>
    <span class="kt">int</span> <span class="n">m_value</span><span class="p">;</span>

<span class="k">public</span><span class="o">:</span>
    <span class="n">Base</span><span class="p">(</span><span class="kt">int</span> <span class="n">value</span><span class="p">)</span>
        <span class="o">:</span> <span class="n">m_value</span><span class="p">{</span> <span class="n">value</span> <span class="p">}</span>
    <span class="p">{</span>
    <span class="p">}</span>

    <span class="n">std</span><span class="o">::</span><span class="n">string_view</span> <span class="n">getName</span><span class="p">()</span> <span class="k">const</span> <span class="p">{</span> <span class="k">return</span> <span class="s">&quot;Base&quot;</span><span class="p">;</span> <span class="p">}</span>
    <span class="kt">int</span> <span class="n">getValue</span><span class="p">()</span> <span class="k">const</span> <span class="p">{</span> <span class="k">return</span> <span class="n">m_value</span><span class="p">;</span> <span class="p">}</span>
<span class="p">};</span>

<span class="k">class</span> <span class="nc">Derived</span><span class="o">:</span> <span class="k">public</span> <span class="n">Base</span>
<span class="p">{</span>
<span class="k">public</span><span class="o">:</span>
    <span class="n">Derived</span><span class="p">(</span><span class="kt">int</span> <span class="n">value</span><span class="p">)</span>
        <span class="o">:</span> <span class="n">Base</span><span class="p">{</span> <span class="n">value</span> <span class="p">}</span>
    <span class="p">{</span>
    <span class="p">}</span>

    <span class="n">std</span><span class="o">::</span><span class="n">string_view</span> <span class="n">getName</span><span class="p">()</span> <span class="k">const</span> <span class="p">{</span> <span class="k">return</span> <span class="s">&quot;Derived&quot;</span><span class="p">;</span> <span class="p">}</span>
    <span class="kt">int</span> <span class="n">getValueDoubled</span><span class="p">()</span> <span class="k">const</span> <span class="p">{</span> <span class="k">return</span> <span class="n">m_value</span> <span class="o">*</span> <span class="mi">2</span><span class="p">;</span> <span class="p">}</span>
<span class="p">};</span>
</code></pre></div>
<!-- When we create a Derived object, it contains a Base part (which is constructed first), and a Derived part (which is constructed second). Remember that inheritance implies an is-a relationship between two classes. Since a Derived is-a Base, it is appropriate that Derived contain a Base part. -->

<p>当我们创建了一个派生的对象，它包含了一个基类部分（先被构造出来），然后包含了一个派生（第二个被构造出来的）。记住继承意味着在两个类间产生了”是一个 (is a)“的关系。因为一个继承类是一个基类，也可以认为继承类包含了一个基类部分。</p>
<!-- Pointers, references, and derived classes -->

<h2 id="_1">指针，引用和继承类<a class="headerlink" href="#_1" title="Permanent link">&para;</a></h2>
<!-- It should be fairly intuitive that we can set Derived pointers and references to Derived objects: -->

<p>非常直观的是，我们可以将派生指针和引用指向派生对象：</p>
<div class="highlight"><pre><span></span><code><span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp"></span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">Derived</span> <span class="n">derived</span><span class="p">{</span> <span class="mi">5</span> <span class="p">};</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;derived is a &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">derived</span><span class="p">.</span><span class="n">getName</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; and has value &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">derived</span><span class="p">.</span><span class="n">getValue</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="sc">&#39;\n&#39;</span><span class="p">;</span>

    <span class="n">Derived</span> <span class="o">&amp;</span><span class="n">rDerived</span><span class="p">{</span> <span class="n">derived</span> <span class="p">};</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;rDerived is a &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">rDerived</span><span class="p">.</span><span class="n">getName</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; and has value &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">rDerived</span><span class="p">.</span><span class="n">getValue</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="sc">&#39;\n&#39;</span><span class="p">;</span>

    <span class="n">Derived</span> <span class="o">*</span><span class="n">pDerived</span><span class="p">{</span> <span class="o">&amp;</span><span class="n">derived</span> <span class="p">};</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;pDerived is a &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">pDerived</span><span class="o">-&gt;</span><span class="n">getName</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; and has value &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">pDerived</span><span class="o">-&gt;</span><span class="n">getValue</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="sc">&#39;\n&#39;</span><span class="p">;</span>

    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<p>下面就是输出：</p>
<!-- This produces the following output: -->

<div class="highlight"><pre><span></span><code><span class="n">derived</span> <span class="n">is</span> <span class="n">a</span> <span class="n">Derived</span> <span class="n">and</span> <span class="n">has</span> <span class="n">value</span> <span class="mi">5</span>
<span class="n">rDerived</span> <span class="n">is</span> <span class="n">a</span> <span class="n">Derived</span> <span class="n">and</span> <span class="n">has</span> <span class="n">value</span> <span class="mi">5</span>
<span class="n">pDerived</span> <span class="n">is</span> <span class="n">a</span> <span class="n">Derived</span> <span class="n">and</span> <span class="n">has</span> <span class="n">value</span> <span class="mi">5</span>
</code></pre></div>
<p>然而，自从派生类有一个基类部分，一个更有趣的问题就是 C++ 将会我们让我们将一个基类指针或者引用指向一个派生类对象。我们确实可以这样做！</p>
<!-- However, since Derived has a Base part, a more interesting question is whether C++ will let us set a Base pointer or reference to a Derived object. It turns out, we can! -->

<div class="highlight"><pre><span></span><code><span class="cp"># include &lt;iostream&gt;</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">Derived</span> <span class="n">derived</span><span class="p">{</span> <span class="mi">5</span> <span class="p">};</span>

    <span class="c1">// These are both legal!</span>
    <span class="n">Base</span> <span class="o">&amp;</span><span class="n">rBase</span><span class="p">{</span> <span class="n">derived</span> <span class="p">};</span>
    <span class="n">Base</span> <span class="o">*</span><span class="n">pBase</span><span class="p">{</span> <span class="o">&amp;</span><span class="n">derived</span> <span class="p">};</span>

    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;derived is a &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">derived</span><span class="p">.</span><span class="n">getName</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; and has value &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">derived</span><span class="p">.</span><span class="n">getValue</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="sc">&#39;\n&#39;</span><span class="p">;</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;rBase is a &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">rBase</span><span class="p">.</span><span class="n">getName</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; and has value &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">rBase</span><span class="p">.</span><span class="n">getValue</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="sc">&#39;\n&#39;</span><span class="p">;</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;pBase is a &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">pBase</span><span class="o">-&gt;</span><span class="n">getName</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; and has value &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">pBase</span><span class="o">-&gt;</span><span class="n">getValue</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="sc">&#39;\n&#39;</span><span class="p">;</span>

    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<!-- This produces the result: -->

<p>这个产生了结果：</p>
<div class="highlight"><pre><span></span><code><span class="n">derived</span> <span class="n">is</span> <span class="n">a</span> <span class="n">Derived</span> <span class="n">and</span> <span class="n">has</span> <span class="n">value</span> <span class="mi">5</span>
<span class="n">rBase</span> <span class="n">is</span> <span class="n">a</span> <span class="n">Base</span> <span class="n">and</span> <span class="n">has</span> <span class="n">value</span> <span class="mi">5</span>
<span class="n">pBase</span> <span class="n">is</span> <span class="n">a</span> <span class="n">Base</span> <span class="n">and</span> <span class="n">has</span> <span class="n">value</span> <span class="mi">5</span>
</code></pre></div>
<!-- This result may not be quite what you were expecting at first! -->

<p>这个结果可能一开始不那么符合你的期望!</p>
<p>事实证明 <code>rBase</code> 和 <code>pBase</code> 是一个基类引用和指针，他们可以仅仅看到基类成员（或者任何从基类继承的类）。因此尽管 <code>Derived::getName()</code> 隐藏了派生对象的<code>Base::getName()</code>，基类指针/引用不可以看到 <code>Derived::getName()</code>。因此，他们调用 <code>Base::getName()</code>，这就是为什么 <code>rBase</code> 和 <code>pBase</code> 显示它们是一个基类而不是一个派生类。</p>
<blockquote>
<p>（上面这句话太难翻译）It turns out that because rBase and pBase are a Base reference and pointer, they can only see members of Base (or any classes that Base inherited). So even though Derived::getName() shadows (hides) Base::getName() for Derived objects, the Base pointer/reference can not see Derived::getName(). Consequently, they call Base::getName(), which is why rBase and pBase report that they are a Base rather than a Derived.</p>
</blockquote>
<!-- Note that this also means it is not possible to call Derived::getValueDoubled() using rBase or pBase. They are unable to see anything in Derived. -->

<p>注意这也意味着不可能从 <code>rBase</code> 和 <code>pBase</code> 来调用 <code>Derived::getValueDoubled()</code>。它们是不可能在派生类中看见的。</p>
<p>这有一个更加复杂的例子，我们将会在下节课中详细说明：</p>
<!-- Here’s another slightly more complex example that we’ll build on in the next lesson: -->

<div class="highlight"><pre><span></span><code><span class="cp"># include &lt;iostream&gt;</span>
<span class="cp"># include &lt;string_view&gt;</span>
<span class="cp"># include &lt;string&gt;</span>

<span class="k">class</span> <span class="nc">Animal</span>
<span class="p">{</span>
<span class="k">protected</span><span class="o">:</span>
    <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">m_name</span><span class="p">;</span>

    <span class="c1">// We&#39;re making this constructor protected because</span>
    <span class="c1">// we don&#39;t want people creating Animal objects directly,</span>
    <span class="c1">// but we still want derived classes to be able to use it.</span>
    <span class="n">Animal</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">string_view</span> <span class="n">name</span><span class="p">)</span>
        <span class="o">:</span> <span class="n">m_name</span><span class="p">{</span> <span class="n">name</span> <span class="p">}</span>
    <span class="p">{</span>
    <span class="p">}</span>

    <span class="c1">// To prevent slicing (covered later)</span>
    <span class="n">Animal</span><span class="p">(</span><span class="k">const</span> <span class="n">Animal</span><span class="o">&amp;</span><span class="p">)</span> <span class="o">=</span> <span class="k">delete</span><span class="p">;</span>
    <span class="n">Animal</span><span class="o">&amp;</span> <span class="k">operator</span><span class="o">=</span><span class="p">(</span><span class="k">const</span> <span class="n">Animal</span><span class="o">&amp;</span><span class="p">)</span> <span class="o">=</span> <span class="k">delete</span><span class="p">;</span>

<span class="k">public</span><span class="o">:</span>
    <span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span> <span class="n">getName</span><span class="p">()</span> <span class="k">const</span> <span class="p">{</span> <span class="k">return</span> <span class="n">m_name</span><span class="p">;</span> <span class="p">}</span>
    <span class="n">std</span><span class="o">::</span><span class="n">string_view</span> <span class="n">speak</span><span class="p">()</span> <span class="k">const</span> <span class="p">{</span> <span class="k">return</span> <span class="s">&quot;???&quot;</span><span class="p">;</span> <span class="p">}</span>
<span class="p">};</span>

<span class="k">class</span> <span class="nc">Cat</span><span class="o">:</span> <span class="k">public</span> <span class="n">Animal</span>
<span class="p">{</span>
<span class="k">public</span><span class="o">:</span>
    <span class="n">Cat</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">string_view</span> <span class="n">name</span><span class="p">)</span>
        <span class="o">:</span> <span class="n">Animal</span><span class="p">{</span> <span class="n">name</span> <span class="p">}</span>
    <span class="p">{</span>
    <span class="p">}</span>

    <span class="n">std</span><span class="o">::</span><span class="n">string_view</span> <span class="n">speak</span><span class="p">()</span> <span class="k">const</span> <span class="p">{</span> <span class="k">return</span> <span class="s">&quot;Meow&quot;</span><span class="p">;</span> <span class="p">}</span>
<span class="p">};</span>

<span class="k">class</span> <span class="nc">Dog</span><span class="o">:</span> <span class="k">public</span> <span class="n">Animal</span>
<span class="p">{</span>
<span class="k">public</span><span class="o">:</span>
    <span class="n">Dog</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">string_view</span> <span class="n">name</span><span class="p">)</span>
        <span class="o">:</span> <span class="n">Animal</span><span class="p">{</span> <span class="n">name</span> <span class="p">}</span>
    <span class="p">{</span>
    <span class="p">}</span>

    <span class="n">std</span><span class="o">::</span><span class="n">string_view</span> <span class="n">speak</span><span class="p">()</span> <span class="k">const</span> <span class="p">{</span> <span class="k">return</span> <span class="s">&quot;Woof&quot;</span><span class="p">;</span> <span class="p">}</span>
<span class="p">};</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
    <span class="k">const</span> <span class="n">Cat</span> <span class="n">cat</span><span class="p">{</span> <span class="s">&quot;Fred&quot;</span> <span class="p">};</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;cat is named &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">cat</span><span class="p">.</span><span class="n">getName</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;, and it says &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">cat</span><span class="p">.</span><span class="n">speak</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="sc">&#39;\n&#39;</span><span class="p">;</span>

    <span class="k">const</span> <span class="n">Dog</span> <span class="n">dog</span><span class="p">{</span> <span class="s">&quot;Garbo&quot;</span> <span class="p">};</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;dog is named &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">dog</span><span class="p">.</span><span class="n">getName</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;, and it says &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">dog</span><span class="p">.</span><span class="n">speak</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="sc">&#39;\n&#39;</span><span class="p">;</span>

    <span class="k">const</span> <span class="n">Animal</span> <span class="o">*</span><span class="n">pAnimal</span><span class="p">{</span> <span class="o">&amp;</span><span class="n">cat</span> <span class="p">};</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;pAnimal is named &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">pAnimal</span><span class="o">-&gt;</span><span class="n">getName</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;, and it says &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">pAnimal</span><span class="o">-&gt;</span><span class="n">speak</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="sc">&#39;\n&#39;</span><span class="p">;</span>

    <span class="n">pAnimal</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">dog</span><span class="p">;</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;pAnimal is named &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">pAnimal</span><span class="o">-&gt;</span><span class="n">getName</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;, and it says &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">pAnimal</span><span class="o">-&gt;</span><span class="n">speak</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="sc">&#39;\n&#39;</span><span class="p">;</span>

    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<p>这生成结果：</p>
<!-- This produces the result: -->

<div class="highlight"><pre><span></span><code><span class="n">cat</span> <span class="n">is</span> <span class="n">named</span> <span class="n">Fred</span><span class="p">,</span> <span class="n">and</span> <span class="n">it</span> <span class="n">says</span> <span class="n">Meow</span>
<span class="n">dog</span> <span class="n">is</span> <span class="n">named</span> <span class="n">Garbo</span><span class="p">,</span> <span class="n">and</span> <span class="n">it</span> <span class="n">says</span> <span class="n">Woof</span>
<span class="n">pAnimal</span> <span class="n">is</span> <span class="n">named</span> <span class="n">Fred</span><span class="p">,</span> <span class="n">and</span> <span class="n">it</span> <span class="n">says</span> <span class="o">???</span>
<span class="n">pAnimal</span> <span class="n">is</span> <span class="n">named</span> <span class="n">Garbo</span><span class="p">,</span> <span class="n">and</span> <span class="n">it</span> <span class="n">says</span> <span class="o">???</span>
</code></pre></div>
<p>我们在这里看到同样的问题。因为 <code>pAnimal</code> 是一个 <code>Animal</code> 指针，它只能看见类中 <code>Animal</code> 部分的。因此， <code>pAnimal-&gt;speak()</code> 调用了 <code>Animal::speak()</code> 而不是 <code>Dog::Speak</code> 或者 <code>Cat::speak()</code> 函数。</p>
<!-- We see the same issue here. Because pAnimal is an Animal pointer, it can only see the Animal portion of the class. Consequently, pAnimal->speak() calls Animal::speak() rather than the Dog::Speak() or Cat::speak() function. -->

<!-- Use for pointers and references to base classes -->
<h2 id="_2">指向基类的指针和引用的使用方法<a class="headerlink" href="#_2" title="Permanent link">&para;</a></h2>
<!-- Now you might be saying, “The above examples seem kind of silly. Why would I set a pointer or reference to the base class of a derived object when I can just use the derived object?” It turns out that there are quite a few good reasons. -->

<p>现在你可能会说，“上面的例子看起来有点蠢，为什么我们不设置一个指针或者引用到一个派生类中的基类部分，这样我们就能使用派生类的对象？”事实证明，有充分的理由。</p>
<!-- First, let’s say you wanted to write a function that printed an animal’s name and sound. Without using a pointer to a base class, you’d have to write it using overloaded functions, like this: -->

<p>首先，我们知道你想要写出一个函数可以打印一个动物的名字和声音。不适用基类指针，你必须像这样写重载函数：</p>
<div class="highlight"><pre><span></span><code><span class="kt">void</span> <span class="nf">report</span><span class="p">(</span><span class="k">const</span> <span class="n">Cat</span> <span class="o">&amp;</span><span class="n">cat</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">cat</span><span class="p">.</span><span class="n">getName</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; says &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">cat</span><span class="p">.</span><span class="n">speak</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="sc">&#39;\n&#39;</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">report</span><span class="p">(</span><span class="k">const</span> <span class="n">Dog</span> <span class="o">&amp;</span><span class="n">dog</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">dog</span><span class="p">.</span><span class="n">getName</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; says &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">dog</span><span class="p">.</span><span class="n">speak</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="sc">&#39;\n&#39;</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<!-- Not too difficult, but consider what would happen if we had 30 different animal types instead of 2. You’d have to write 30 almost identical functions! Plus, if you ever added a new type of animal, you’d have to write a new function for that one too. This is a huge waste of time considering the only real difference is the type of the parameter. -->
<p>不是很复杂，但是想象如果你有30种不同的动物，而不是两种。你就需要写三十种不同的函数！而且，如果你每添加一种新的动物，你就要为这个动物写一个新的函数。这是一个巨大的时间浪费，因为我们可以发现只有类型的参数不同。</p>
<!-- However, because Cat and Dog are derived from Animal, Cat and Dog have an Animal part. Therefore, it makes sense that we should be able to do something like this: -->

<p>然而，因为 <code>Cat</code> 和 <code>Dog</code> 是派生于 <code>Animal</code>，<code>Cat</code> 和 <code>Dog</code> 都有 <code>Animal</code> 的基类部分。因此，我们就可以像这样做啦：</p>
<div class="highlight"><pre><span></span><code><span class="kt">void</span> <span class="nf">report</span><span class="p">(</span><span class="k">const</span> <span class="n">Animal</span> <span class="o">&amp;</span><span class="n">rAnimal</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">rAnimal</span><span class="p">.</span><span class="n">getName</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; says &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">rAnimal</span><span class="p">.</span><span class="n">speak</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="sc">&#39;\n&#39;</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<!-- This would let us pass in any class derived from Animal, even ones that we created after we wrote the function! Instead of one function per derived class, we get one function that works with all classes derived from Animal! -->

<p>我们就可以传入任何的 <code>Animal</code> 派生类，甚至是我们在写这个函数以后创建新的派生类！而无需给每个派生类都写一个函数，我们就得到了一个可以为所有 <code>Animal</code> 派生类服务的函数。</p>
<!-- The problem is, of course, that because rAnimal is an Animal reference, rAnimal.speak() will call Animal::speak() instead of the derived version of speak(). -->

<p>问题是，当然，因为 <code>rAnimal</code> 是一个 <code>Animal</code> 引用，<code>rAnimal.speak()</code> 将会调用 <code>Animal::speak()</code> 而不是派生类版本的 <code>speak()</code>。</p>
<!-- Second, let’s say you had 3 cats and 3 dogs that you wanted to keep in an array for easy access. Because arrays can only hold objects of one type, without a pointer or reference to a base class, you’d have to create a different array for each derived type, like this: -->

<p>其次，我们现在有三个 <code>cats</code> 和 三个 <code>dogs</code> 你想要把他们放在数组里，方便你去访问。因为数组只能持有一个对象的类型，如果不使用基类指针或者引用，你就不得不创建两个不同的数组分别给两个不同的类型，像这样：</p>
<div class="highlight"><pre><span></span><code><span class="cp"># include &lt;array&gt;</span>
<span class="cp"># include &lt;iostream&gt;</span>

<span class="c1">// Cat and Dog from the example above</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
    <span class="k">const</span> <span class="k">auto</span> <span class="n">cats</span><span class="p">{</span> <span class="n">std</span><span class="o">::</span><span class="n">to_array</span><span class="o">&lt;</span><span class="n">Cat</span><span class="o">&gt;</span><span class="p">({{</span> <span class="s">&quot;Fred&quot;</span> <span class="p">},</span> <span class="p">{</span> <span class="s">&quot;Misty&quot;</span> <span class="p">},</span> <span class="p">{</span> <span class="s">&quot;Zeke&quot;</span> <span class="p">}})</span> <span class="p">};</span>
    <span class="k">const</span> <span class="k">auto</span> <span class="n">dogs</span><span class="p">{</span> <span class="n">std</span><span class="o">::</span><span class="n">to_array</span><span class="o">&lt;</span><span class="n">Dog</span><span class="o">&gt;</span><span class="p">({{</span> <span class="s">&quot;Garbo&quot;</span> <span class="p">},</span> <span class="p">{</span> <span class="s">&quot;Pooky&quot;</span> <span class="p">},</span> <span class="p">{</span> <span class="s">&quot;Truffle&quot;</span> <span class="p">}})</span> <span class="p">};</span>

    <span class="c1">// Before C++20</span>
    <span class="c1">// const std::array&lt;Cat, 3&gt; cats{{ { &quot;Fred&quot; }, { &quot;Misty&quot; }, { &quot;Zeke&quot; } }};</span>
    <span class="c1">// const std::array&lt;Dog, 3&gt; dogs{{ { &quot;Garbo&quot; }, { &quot;Pooky&quot; }, { &quot;Truffle&quot; } }};</span>

    <span class="k">for</span> <span class="p">(</span><span class="k">const</span> <span class="k">auto</span><span class="o">&amp;</span> <span class="nl">cat</span> <span class="p">:</span> <span class="n">cats</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">cat</span><span class="p">.</span><span class="n">getName</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; says &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">cat</span><span class="p">.</span><span class="n">speak</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="sc">&#39;\n&#39;</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">for</span> <span class="p">(</span><span class="k">const</span> <span class="k">auto</span><span class="o">&amp;</span> <span class="nl">dog</span> <span class="p">:</span> <span class="n">dogs</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">dog</span><span class="p">.</span><span class="n">getName</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; says &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">dog</span><span class="p">.</span><span class="n">speak</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="sc">&#39;\n&#39;</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<p>现在，想象如果有三十种不同的动物，你需要30个不同的数组，每种动物都需要一个！</p>
<!-- Now, consider what would happen if you had 30 different types of animals. You’d need 30 arrays, one for each type of animal! -->

<!-- However, because both Cat and Dog are derived from Animal, it makes sense that we should be able to do something like this: -->

<p>然而，因为 <code>Cat</code> 和 <code>Dog</code> 是从 <code>Animal</code> 派生的，我们也可以去做一些事，像这样：</p>
<div class="highlight"><pre><span></span><code><span class="cp"># include &lt;iostream&gt;</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
    <span class="k">const</span> <span class="n">Cat</span> <span class="n">fred</span><span class="p">{</span> <span class="s">&quot;Fred&quot;</span> <span class="p">};</span>
    <span class="k">const</span> <span class="n">Cat</span> <span class="n">misty</span><span class="p">{</span> <span class="s">&quot;Misty&quot;</span> <span class="p">};</span>
    <span class="k">const</span> <span class="n">Cat</span> <span class="n">zeke</span><span class="p">{</span> <span class="s">&quot;Zeke&quot;</span> <span class="p">};</span>

    <span class="k">const</span> <span class="n">Dog</span> <span class="n">garbo</span><span class="p">{</span> <span class="s">&quot;Garbo&quot;</span> <span class="p">};</span>
    <span class="k">const</span> <span class="n">Dog</span> <span class="n">pooky</span><span class="p">{</span> <span class="s">&quot;Pooky&quot;</span> <span class="p">};</span>
    <span class="k">const</span> <span class="n">Dog</span> <span class="n">truffle</span><span class="p">{</span> <span class="s">&quot;Truffle&quot;</span> <span class="p">};</span>

    <span class="c1">// Set up an array of pointers to animals, and set those pointers to our Cat and Dog objects</span>
    <span class="k">const</span> <span class="k">auto</span> <span class="n">animals</span><span class="p">{</span> <span class="n">std</span><span class="o">::</span><span class="n">to_array</span><span class="o">&lt;</span><span class="k">const</span> <span class="n">Animal</span><span class="o">*&gt;</span><span class="p">({</span><span class="o">&amp;</span><span class="n">fred</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">garbo</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">misty</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">pooky</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">truffle</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">zeke</span> <span class="p">})</span> <span class="p">};</span>

    <span class="c1">// Before C++20, with the array size being explicitly specified</span>
    <span class="c1">// const std::array&lt;const Animal*, 6&gt; animals{ &amp;fred, &amp;garbo, &amp;misty, &amp;pooky, &amp;truffle, &amp;zeke };</span>

    <span class="k">for</span> <span class="p">(</span><span class="k">const</span> <span class="k">auto</span> <span class="nl">animal</span> <span class="p">:</span> <span class="n">animals</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">animal</span><span class="o">-&gt;</span><span class="n">getName</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; says &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">animal</span><span class="o">-&gt;</span><span class="n">speak</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="sc">&#39;\n&#39;</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<!-- While this compiles and executes, unfortunately the fact that each element of array “animals” is a pointer to an Animal means that animal->speak() will call Animal::speak() instead of the derived class version of speak() that we want. The output is -->

<p>当这个编译执行时，不幸的是每个 <code>animals</code> 是一个指针指向一个 <code>Animal</code> 这意味着 <code>animal-&gt;speak()</code> 将会调用 <code>Animal::speak()</code> 而不是派生类版本的我们想要的派生类版本的 <code>speak()</code>，这会得到输出：</p>
<div class="highlight"><pre><span></span><code><span class="n">Fred</span> <span class="n">says</span> <span class="o">???</span>
<span class="n">Garbo</span> <span class="n">says</span> <span class="o">???</span>
<span class="n">Misty</span> <span class="n">says</span> <span class="o">???</span>
<span class="n">Pooky</span> <span class="n">says</span> <span class="o">???</span>
<span class="n">Truffle</span> <span class="n">says</span> <span class="o">???</span>
<span class="n">Zeke</span> <span class="n">says</span> <span class="o">???</span>
</code></pre></div>
<!-- Although both of these techniques could save us a lot of time and energy, they have the same problem. The pointer or reference to the base class calls the base version of the function rather than the derived version. If only there was some way to make those base pointers call the derived version of a function instead of the base version… -->

<p>尽管这些技巧可以节省我们大量的时间和能量，他们也有同样的问题。指向基类的指针或者引用调用基类版本的函数而不是派生类版本的。假设我们有一些方式使得那些基类指针调用派生类版本的函数而不是基类版本的……</p>
<p>请猜猜虚函数是干啥用的？:)</p>
<!-- Want to take a guess what virtual functions are for? :) -->

<p>Quiz time</p>
<p>1）我们的 <code>Animal/Cat/Dog</code> 解释了上方的代码不能像我们想象的那样去工作，因为一个引用或者指针指向 <code>Animal</code> 不能访问派生类的版本的 <code>speak()</code> 需要返回一个 <code>Cat</code> 或者 <code>Dog</code> 的正确值。唯一的方式就是使得 <code>speak()</code> 返回的数据成为 <code>Animal</code> 基类的一部分（就像是 <code>Animal</code> 的 name 是通过 m_name 这个成员来访问的）</p>
<blockquote>
<p>（题目翻译也许有问题）1) Our Animal/Cat/Dog example above doesn’t work like we want because a reference or pointer to an Animal can’t access the derived version of speak() needed to return the right value for the Cat or Dog. One way to work around this issue would be to make the data returned by the speak() function accessible as part of the Animal base class (much like the Animal’s name is accessible via member m_name).</p>
</blockquote>
<p>Update the Animal, Cat, and Dog classes in the lesson above by adding a new member to Animal named m_speak. Initialize it appropriately. The following program should work properly:</p>
<p>更新之前课程中编写的 <code>Animal, Cat, Dog</code> 三个类，通过添加一个新的成员 m_speak 到 <code>Animal</code> 基类。以合适的方式初始化他们，下面的程序能够很好的工作。</p>
<div class="highlight"><pre><span></span><code><span class="cp"># include &lt;array&gt;</span>
<span class="cp"># include &lt;iostream&gt;</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
    <span class="k">const</span> <span class="n">Cat</span> <span class="n">fred</span><span class="p">{</span> <span class="s">&quot;Fred&quot;</span> <span class="p">};</span>
    <span class="k">const</span> <span class="n">Cat</span> <span class="n">misty</span><span class="p">{</span> <span class="s">&quot;Misty&quot;</span> <span class="p">};</span>
    <span class="k">const</span> <span class="n">Cat</span> <span class="n">zeke</span><span class="p">{</span> <span class="s">&quot;Zeke&quot;</span> <span class="p">};</span>

    <span class="k">const</span> <span class="n">Dog</span> <span class="n">garbo</span><span class="p">{</span> <span class="s">&quot;Garbo&quot;</span> <span class="p">};</span>
    <span class="k">const</span> <span class="n">Dog</span> <span class="n">pooky</span><span class="p">{</span> <span class="s">&quot;Pooky&quot;</span> <span class="p">};</span>
    <span class="k">const</span> <span class="n">Dog</span> <span class="n">truffle</span><span class="p">{</span> <span class="s">&quot;Truffle&quot;</span> <span class="p">};</span>

    <span class="c1">// Set up an array of pointers to animals, and set those pointers to our Cat and Dog objects</span>
    <span class="k">const</span> <span class="k">auto</span> <span class="n">animals</span><span class="p">{</span> <span class="n">std</span><span class="o">::</span><span class="n">to_array</span><span class="o">&lt;</span><span class="k">const</span> <span class="n">Animal</span><span class="o">*&gt;</span><span class="p">({</span> <span class="o">&amp;</span><span class="n">fred</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">garbo</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">misty</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">pooky</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">truffle</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">zeke</span> <span class="p">})</span> <span class="p">};</span>

    <span class="c1">// Before C++20, with the array size being explicitly specified</span>
    <span class="c1">// const std::array&lt;const Animal*, 6&gt; animals{ &amp;fred, &amp;garbo, &amp;misty, &amp;pooky, &amp;truffle, &amp;zeke };</span>

    <span class="k">for</span> <span class="p">(</span><span class="k">const</span> <span class="k">auto</span> <span class="nl">animal</span> <span class="p">:</span> <span class="n">animals</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">animal</span><span class="o">-&gt;</span><span class="n">getName</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; says &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">animal</span><span class="o">-&gt;</span><span class="n">speak</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="sc">&#39;\n&#39;</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<p>答案：</p>
<div class="highlight"><pre><span></span><code><span class="cp"># include &lt;array&gt;</span>
<span class="cp"># include &lt;string&gt;</span>
<span class="cp"># include &lt;string_view&gt;</span>
<span class="cp"># include &lt;iostream&gt;</span>

<span class="k">class</span> <span class="nc">Animal</span>
<span class="p">{</span>
<span class="k">protected</span><span class="o">:</span>
    <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">m_name</span><span class="p">{};</span>
    <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">m_speak</span><span class="p">{};</span>

    <span class="c1">// We&#39;re making this constructor protected because</span>
    <span class="c1">// we don&#39;t want people creating Animal objects directly,</span>
    <span class="c1">// but we still want derived classes to be able to use it.</span>
    <span class="n">Animal</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">string_view</span> <span class="n">name</span><span class="p">,</span> <span class="n">std</span><span class="o">::</span><span class="n">string_view</span> <span class="n">speak</span><span class="p">)</span>
        <span class="o">:</span> <span class="n">m_name</span><span class="p">{</span> <span class="n">name</span> <span class="p">},</span> <span class="n">m_speak</span><span class="p">{</span> <span class="n">speak</span> <span class="p">}</span>
    <span class="p">{</span>
    <span class="p">}</span>

    <span class="c1">// To prevent slicing (covered later)</span>
    <span class="n">Animal</span><span class="p">(</span><span class="k">const</span> <span class="n">Animal</span><span class="o">&amp;</span><span class="p">)</span> <span class="o">=</span> <span class="k">delete</span><span class="p">;</span>
    <span class="n">Animal</span><span class="o">&amp;</span> <span class="k">operator</span><span class="o">=</span><span class="p">(</span><span class="k">const</span> <span class="n">Animal</span><span class="o">&amp;</span><span class="p">)</span> <span class="o">=</span> <span class="k">delete</span><span class="p">;</span>

<span class="k">public</span><span class="o">:</span>
    <span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span> <span class="n">getName</span><span class="p">()</span> <span class="k">const</span> <span class="p">{</span> <span class="k">return</span> <span class="n">m_name</span><span class="p">;</span> <span class="p">}</span>
    <span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span> <span class="n">speak</span><span class="p">()</span> <span class="k">const</span> <span class="p">{</span> <span class="k">return</span> <span class="n">m_speak</span><span class="p">;</span> <span class="p">}</span>
<span class="p">};</span>

<span class="k">class</span> <span class="nc">Cat</span><span class="o">:</span> <span class="k">public</span> <span class="n">Animal</span>
<span class="p">{</span>
<span class="k">public</span><span class="o">:</span>
    <span class="n">Cat</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">string_view</span> <span class="n">name</span><span class="p">)</span>
        <span class="o">:</span> <span class="n">Animal</span><span class="p">{</span> <span class="n">name</span><span class="p">,</span> <span class="s">&quot;Meow&quot;</span> <span class="p">}</span>
    <span class="p">{</span>
    <span class="p">}</span>
<span class="p">};</span>

<span class="k">class</span> <span class="nc">Dog</span><span class="o">:</span> <span class="k">public</span> <span class="n">Animal</span>
<span class="p">{</span>
<span class="k">public</span><span class="o">:</span>
    <span class="n">Dog</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">string_view</span> <span class="n">name</span><span class="p">)</span>
        <span class="o">:</span> <span class="n">Animal</span><span class="p">{</span> <span class="n">name</span><span class="p">,</span> <span class="s">&quot;Woof&quot;</span> <span class="p">}</span>
    <span class="p">{</span>
    <span class="p">}</span>
<span class="p">};</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
    <span class="k">const</span> <span class="n">Cat</span> <span class="n">fred</span><span class="p">{</span> <span class="s">&quot;Fred&quot;</span> <span class="p">};</span>
    <span class="k">const</span> <span class="n">Cat</span> <span class="n">misty</span><span class="p">{</span> <span class="s">&quot;Misty&quot;</span> <span class="p">};</span>
    <span class="k">const</span> <span class="n">Cat</span> <span class="n">zeke</span><span class="p">{</span> <span class="s">&quot;Zeke&quot;</span> <span class="p">};</span>

    <span class="k">const</span> <span class="n">Dog</span> <span class="n">garbo</span><span class="p">{</span> <span class="s">&quot;Garbo&quot;</span> <span class="p">};</span>
    <span class="k">const</span> <span class="n">Dog</span> <span class="n">pooky</span><span class="p">{</span> <span class="s">&quot;Pooky&quot;</span> <span class="p">};</span>
    <span class="k">const</span> <span class="n">Dog</span> <span class="n">truffle</span><span class="p">{</span> <span class="s">&quot;Truffle&quot;</span> <span class="p">};</span>

    <span class="c1">// Set up an array of pointers to animals, and set those pointers to our Cat and Dog objects</span>
    <span class="k">const</span> <span class="k">auto</span> <span class="n">animals</span><span class="p">{</span> <span class="n">std</span><span class="o">::</span><span class="n">to_array</span><span class="o">&lt;</span><span class="k">const</span> <span class="n">Animal</span><span class="o">*&gt;</span><span class="p">({</span> <span class="o">&amp;</span><span class="n">fred</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">garbo</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">misty</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">pooky</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">truffle</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">zeke</span> <span class="p">})</span> <span class="p">};</span>

    <span class="c1">// Before C++20, with the array size being explicitly specified</span>
    <span class="c1">// const std::array&lt;const Animal*, 6&gt; animals{ &amp;fred, &amp;garbo, &amp;misty, &amp;pooky, &amp;truffle, &amp;zeke };</span>

    <span class="c1">// animal is not a reference, because we&#39;re looping over pointers</span>
    <span class="k">for</span> <span class="p">(</span><span class="k">const</span> <span class="k">auto</span> <span class="nl">animal</span> <span class="p">:</span> <span class="n">animals</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">animal</span><span class="o">-&gt;</span><span class="n">getName</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; says &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">animal</span><span class="o">-&gt;</span><span class="n">speak</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="sc">&#39;\n&#39;</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<!-- 2) Why is the above solution non-optimal? -->

<p>2）为什么上面的解决方案不是最优的？</p>
<!-- Hint: Think about the future state of Cat and Dog where we want to differentiate Cats and Dogs in more ways. -->
<!-- Hint: Think about the ways in which having a member that needs to be set at initialization limits you. -->

<p>提示：想想猫和狗的未来状态，我们想用更多的方式来区分猫和狗</p>
<p>提示：考虑一下在初始化时需要设置的成员对您的限制。</p>
<!-- The current solution is non-optimal because we need to add a member for each way we wanted to differentiate Cat and Dog. Over time, our Animal class could become quite large memory-wise, and complicated! -->

<p>当前的解决方案并不是最优的，原因是我们必须给每个不同的类添加一个成员来分辨 <code>Cat</code> 和 <code>Dog</code>，一段时间之后，我们的 <code>Animal</code> 类可能变得非常消耗内存并且非常复杂！</p>
<!-- Also, this solution only works if the base class member can be determined at initialization time. For example, if speak() returned a randomized result for each Animal (e.g. calling Dog::speak() could return “woof”, “arf”, or “yip”), this kind of solution starts to get awkward and fall apart. -->

<p>而且，这个方法只能在初始化的时候决定才能正常工作。举个例子，如果 <code>speak()</code> 返回了一个随机的结果，为每个 <code>Animal</code> 类（例如调用 <code>Dog::speak()</code> 可能返回 <code>woof</code>，<code>arf</code>，或者 <code>yip</code>），这类的解决方案开始变得尴尬、崩溃。</p>
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <nav class="md-footer__inner md-grid" aria-label="Footer">
      
        <a href="../" class="md-footer__link md-footer__link--prev" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              第十八章 虚函数
            </div>
          </div>
        </a>
      
      
        <a href="../18.2-virtual-functions-and-polymorphism/" class="md-footer__link md-footer__link--next" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              18.2 — 虚函数和多态
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "../..", "features": [], "translations": {"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing"}, "search": "../../assets/javascripts/workers/search.217ffd95.min.js", "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.926459b3.min.js"></script>
      
    
  </body>
</html>